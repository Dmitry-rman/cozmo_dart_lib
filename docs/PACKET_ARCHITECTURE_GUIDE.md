
# ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ² Cozmo: Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ²Ğ¾Ğ´ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ¸ Ğ°ÑƒĞ´Ğ¸Ğ¾

## ğŸ“‹ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

1. [ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹](#Ğ¾Ğ±Ğ·Ğ¾Ñ€-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹)
2. [Ğ¡ĞµÑ‚ĞµĞ²Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ](#ÑĞµÑ‚ĞµĞ²Ğ¾Ğ¹-ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ)
3. [ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ» Ñ„Ñ€ĞµĞ¹Ğ¼Ğ¾Ğ²](#Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»-Ñ„Ñ€ĞµĞ¹Ğ¼Ğ¾Ğ²)
4. [ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²](#Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ-Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²)
5. [ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ¸ Ğ²Ğ¸Ğ´ĞµĞ¾](#ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ-Ğ°ÑƒĞ´Ğ¸Ğ¾-Ğ¸-Ğ²Ğ¸Ğ´ĞµĞ¾)
6. [ĞŸÑ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹](#Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ-Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹)
7. [Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Ğ¸ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ°](#Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°-Ğ¸-Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ°)
8. [ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸](#Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ-Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸)

---

## ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

### Ğ˜ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´Ğ½Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   Audio Module   â”‚  â”‚  Image Module    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              AnimationController                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚ Audio State â”‚  â”‚ Image State  â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚   Manager   â”‚  â”‚   Manager    â”‚                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ½Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  CozmoClient                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚ SendThread  â”‚  â”‚ ReceiveThread â”‚                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ¡ĞµÑ‚ĞµĞ²Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     UDP Socket                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚            Ğ¡Ğ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ Cozmo                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚            IP: 172.31.1.1:5551                  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

1. **Reliable UDP** - Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ» UDP Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ TCP
2. **Sliding Window** - ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° Ñ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸ĞµĞ¼ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸
3. **Audio Takeover** - ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ¸ Ğ²Ğ¸Ğ´ĞµĞ¾
4. **Frame-based Protocol** - Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ´Ğ°ÑÑ‚ÑÑ Ğ²Ğ¾ Ñ„Ñ€ĞµĞ¹Ğ¼Ğ°Ñ…
5. **Packet Sequencing** - ÑÑ‚Ñ€Ğ¾Ğ³Ğ°Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²

---

## Ğ¡ĞµÑ‚ĞµĞ²Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ

### UDP ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ

Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ÑĞµÑ‚ĞµĞ²Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¾ÑĞ½Ğ¾Ğ²Ğ°Ğ½ Ğ½Ğ° UDP ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¸ Ñ Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ°Ğ¼Ğ¸:

```dart
// ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ
const String COZMO_IP = '172.31.1.1';
const int COZMO_PORT = 5551;

// Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞ¾ĞºĞµÑ‚Ğ°
final socket = await RawDatagramSocket.bind(InternetAddress.anyIPv4, 0);
socket.broadcastEnabled = true;
socket.multicastHops = 1;
```

### Reliable UDP Implementation

Ğ¡ĞµÑ‚ĞµĞ²Ğ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚ Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… UDP Ñ‡ĞµÑ€ĞµĞ· Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ñ€ĞµÑ‚Ñ€Ğ°Ğ½ÑĞ»ÑÑ†Ğ¸Ğ¸:

### Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ² pycozmo

**SendThread** (conn.py:45-46):
```python
COLLECT_INTERVAL = 1/30 / 3  # ~11 Ğ¼Ñ - Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ÑĞ±Ğ¾Ñ€Ğ° Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²
ACK_TIMEOUT = 3 * 1/30       # 100 Ğ¼Ñ Ğ´Ğ»Ñ ACK

def _collect_messages(self) -> Tuple[list, int]:
    with self.lock:
        last_ack = self.last_ack
        is_full = self.window.is_full()
    
    pkts = []
    start = time.perf_counter()
    while not is_full and not self.disconnected and time.perf_counter() - start < self.COLLECT_INTERVAL:
        try:
            pkt = self.queue.get(timeout=self.COLLECT_INTERVAL)
        except Empty:
            continue
        self.outgoing_packets += 1
        # ĞŸĞ°ĞºĞµÑ‚Ñ‹ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ ĞºĞ»Ğ°Ğ´ÑƒÑ‚ÑÑ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ Ğ‘Ğ•Ğ— Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞµĞº!
        with self.lock:
            seq = self.window.put(pkt)
            last_ack = self.last_ack
            is_full = self.window.is_full()
        pkts.append((seq, pkt))
    return pkts, last_ack
```

**ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ**:
```dart
class ReliableUDPLayer {
  final Map<int, InFlightPacket> _inflightPackets = {};
  final Map<int, DateTime> _packetTimestamps = {};
  int _nextSequence = 0;
  int _lastRemoteAck = -1;
  
  // Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¾ĞºĞ½Ğ° Ğ´Ğ»Ñ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ñ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ°
  static const int _WINDOW_SIZE = 32;
  
  // Ğ¢Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ Ñ€ĞµÑ‚Ñ€Ğ°Ğ½ÑĞ»ÑÑ†Ğ¸Ğ¸
  static const int _RTO_MS = 25;
  
  void _tick(Timer timer) {
    // 1. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ°ĞºĞµÑ‚Ñ‹
    _removeAcknowledgedPackets();
    
    // 2. Ğ ĞµÑ‚Ñ€Ğ°Ğ½ÑĞ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ½Ğ½Ñ‹Ğµ
    _retransmitLostPackets();
    
    // 3. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ°ĞºĞµÑ‚Ñ‹
    _sendNewPackets();
    
    // 4. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ PING Ğ´Ğ»Ñ keep-alive
    _sendKeepAlive();
  }
}
```

---

## ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ» Ñ„Ñ€ĞµĞ¹Ğ¼Ğ¾Ğ²

### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ñ€ĞµĞ¹Ğ¼Ğ°

ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ„Ñ€ĞµĞ¹Ğ¼ Ğ¸Ğ¼ĞµĞµÑ‚ Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½ÑƒÑ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ:

```
+--------+--------+--------+--------+--------+--------+--------+
|                     FRAME_ID (7 Ğ±Ğ°Ğ¹Ñ‚)                      |
+--------+--------+--------+--------+--------+--------+--------+
| Type   | FirstSeq|   Seq  |   Ack  |   Payload...               |
| (1 Ğ±Ğ°Ğ¹Ñ‚)| (2 Ğ±Ğ°Ğ¹Ñ‚Ğ°)|(2 Ğ±Ğ°Ğ¹Ñ‚Ğ°)|(2 Ğ±Ğ°Ğ¹Ñ‚Ğ°)|(Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ´Ğ»Ğ¸Ğ½Ğ°)     |
+--------+--------+--------+--------+--------+---------------------+
```

### Frame Types

| Type | Value | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ |
|------|-------|----------|---------------|
| RESET | 0x01 | Ğ¡Ğ±Ñ€Ğ¾Ñ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ | ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ ÑĞµÑÑĞ¸Ğ¸ |
| RESET_ACK | 0x02 | ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ ÑĞ±Ñ€Ğ¾ÑĞ° | ĞÑ‚Ğ²ĞµÑ‚ Ğ½Ğ° RESET |
| FIN | 0x03 | Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ | ĞšĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğµ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ |
| ENGINE_ACT | 0x04 | ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»Ñ | ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ/Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ |
| ENGINE | 0x07 | ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğº Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ñƒ | ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ |
| ROBOT | 0x09 | Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¾Ñ‚ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ° | ĞÑ‚Ğ²ĞµÑ‚Ñ‹ Ğ¸ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ |
| PING | 0x0b | Ping/Keep-alive | ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ |

### Sequence Numbers

ĞœĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ğ½ÑƒĞ¼ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ĞµĞ¹ Ğ´Ğ»Ñ Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞ° Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²:

```dart
// ĞšĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ sequence numbers
void _writeSequenceNumbers(ByteWriter writer) {
  writer.writeUint16(_firstSeq + 1);  // +1 Ğ´Ğ»Ñ ĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
  writer.writeUint16(_seq + 1);       // +1 Ğ´Ğ»Ñ ĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
  writer.writeUint16(_ack + 1);       // +1 Ğ´Ğ»Ñ ĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
}

// Ğ”ĞµĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
int _decodeSequence(int encoded) => encoded - 1;
```

---

## ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²

### Ğ˜ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²

```
Frame (ENGINE/ROBOT)
  â””â”€â”€ Packet (COMMAND/EVENT)
      â””â”€â”€ CommandID/EventID
          â””â”€â”€ Payload (ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)
```

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ¸ Ğ²Ğ¸Ğ´ĞµĞ¾

| ID | ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ | Ğ¢Ğ¸Ğ¿ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ |
|----|----------|-----|----------|-----------|
| 0x8e | OutputAudio | ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° | Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ¸ Ğ°ÑƒĞ´Ğ¸Ğ¾ | u-law samples[744] |
| 0x8f | OutputSilence | ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° | Ğ¢Ğ¸ÑˆĞ¸Ğ½Ğ° (keep-alive) | - |
| 0x26 | PlayAnimationTrigger | ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° | Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ | trigger_id |
| 0x25 | Enable | ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° | Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ | - |
| 0x37 | SetHeadAngle | ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° | Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑƒĞ³Ğ¾Ğ» Ğ³Ğ¾Ğ»Ğ¾Ğ²Ñ‹ | angle, speed, accel |
| 0x01 | RobotState | Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ | Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ° | pose, battery, etc. |

### Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²

```
+--------+--------+--------+--------+
| Type   | Length | CmdID  | Samples            |
| (1 Ğ±Ğ°Ğ¹Ñ‚)|(2 Ğ±Ğ°Ğ¹Ñ‚Ğ°)|(1 Ğ±Ğ°Ğ¹Ñ‚)|(744 Ğ±Ğ°Ğ¹Ñ‚Ğ°)        |
+--------+--------+--------+--------------------+
| 0x04   | 0xE902 | 0x8e   | u-law encoded...  |
+--------+--------+--------+--------------------+
```

### Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ² Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹

```
+--------+--------+--------+--------+
| Type   | Length | CmdID  | Image Payload       |
| (1 Ğ±Ğ°Ğ¹Ñ‚)|(2 Ğ±Ğ°Ğ¹Ñ‚Ğ°)|(1 Ğ±Ğ°Ğ¹Ñ‚)|(Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ´Ğ»Ğ¸Ğ½Ğ°)  |
+--------+--------+--------+---------------------+
| 0x04   | varies | varies | RLE compressed data |
+--------+--------+--------+---------------------+
```

---

## ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ¸ Ğ²Ğ¸Ğ´ĞµĞ¾

### Audio Takeover Pattern

ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° OutputSilence (0x8f) Ğ¸ OutputAudio (0x8e) Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ñ‹.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Audio Takeover Pattern

```dart
class CozmoAnimController {
  bool _isAudioBusy = false;
  
  void _tick() {
    // 1. ĞĞ£Ğ”Ğ˜Ğ / Ğ¢Ğ˜Ğ¨Ğ˜ĞĞ
    if (!_isAudioBusy) {
      _client.sendCommand(CozmoCmd.outputSilence, []);
    }
    
    // 2. Ğ­ĞšĞ ĞĞ (Ğ”ĞĞ–Ğ• Ğ’Ğ Ğ’Ğ Ğ•ĞœĞ¯ ĞĞ£Ğ”Ğ˜Ğ!)
    if (_tickCounter % 30 == 0 && _currentImagePayload != null) {
      _client.sendCommand(CozmoCmd.displayImage, _currentImagePayload!);
    }
    
    _tickCounter++;
  }
  
  void setAudioBusy(bool busy) {
    _isAudioBusy = busy;
  }
}
```

### ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸

```dart
Future<void> _streamAudioPackets(List<List<int>> packets) async {
  // 1. Ğ—ĞĞ¥Ğ’ĞĞ¢Ğ«Ğ’ĞĞ•Ğœ ĞšĞĞĞ¢Ğ ĞĞ›Ğ¬
  _animController.setAudioBusy(true);
  
  try {
    // 2. Ğ‘Ğ«Ğ¡Ğ¢Ğ ĞĞ¯ ĞĞ¢ĞŸĞ ĞĞ’ĞšĞ (Ğ±ĞµĞ· Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³Ğ°!)
    for (int i = 0; i < packets.length; i++) {
      // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ backpressure Ñ‚Ğ¾Ñ€Ğ¼Ğ¾Ğ·Ğ¸Ñ‚ Ğ½Ğ°Ñ
      while (_client.outboundQueueLength > 100) {
        await Future.delayed(Duration(milliseconds: 1));
      }
      _client.sendRawPacket(packets[i]);
    }
    
    // 3. Ğ–Ğ´ĞµĞ¼ Ğ¿Ğ¾ĞºĞ° Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ Ğ¾Ğ¿ÑƒÑÑ‚ĞµĞµÑ‚
    while (_client.outboundQueueLength > 0) {
      await Future.delayed(Duration(milliseconds: 50));
    }
  } finally {
    // 4. Ğ’ĞĞ—Ğ’Ğ ĞĞ©ĞĞ•Ğœ ĞšĞĞĞ¢Ğ ĞĞ›Ğ¬
    _animController.setAudioBusy(false);
  }
}
```

### Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹

```
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚         AnimationController          â”‚
            â”‚                                     â”‚
            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
            â”‚  â”‚   IDLE      â”‚    â”‚AUDIO BUSY  â”‚ â”‚
            â”‚  â”‚             â”‚    â”‚            â”‚ â”‚
            â”‚  â”‚OutputSilenceâ”‚â—„â”€â”€â–ºâ”‚ĞœĞĞ›Ğ§Ğ˜Ğ¢!     â”‚ â”‚
            â”‚  â”‚DisplayImage â”‚    â”‚DisplayImageâ”‚ â”‚
            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
            â”‚         â–²                  â–²        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                  â”‚
           audio ends â”‚                  â”‚ audio starts
                      â”‚                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚            Audio Module              â”‚
            â”‚                                     â”‚
            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
            â”‚  â”‚       _streamPackets()          â”‚ â”‚
            â”‚  â”‚                                 â”‚ â”‚
            â”‚  â”‚1. setAudioBusy(true) â† Ğ—ĞĞ¥Ğ’ĞĞ¢   â”‚ â”‚
            â”‚  â”‚2. Send packets FAST              â”‚ â”‚
            â”‚  â”‚3. Wait queue empty               â”‚ â”‚
            â”‚  â”‚4. setAudioBusy(false)â†Ğ’ĞĞ—Ğ’Ğ ĞĞ¢   â”‚ â”‚
            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ĞŸÑ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 1: Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ Ğ°ÑƒĞ´Ğ¸Ğ¾

```dart
Future<void> playBasicAudio(String wavFilePath) async {
  // 1. Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ WAV Ñ„Ğ°Ğ¹Ğ»
  final file = File(wavFilePath);
  final bytes = await file.readAsBytes();
  
  // 2. ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² u-law Ğ¿Ğ°ĞºĞµÑ‚Ñ‹
  final packets = _convertToUlaw(bytes);
  
  // 3. Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Audio Takeover
  await _streamAudioPackets(packets);
}

List<List<int>> _convertToUlaw(Uint8List wavData) {
  final packets = <List<int>>[];
  
  // Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ PCM Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· WAV
  final pcmData = _extractPCMFromWAV(wavData);
  
  // Ğ Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ¿Ğ°ĞºĞµÑ‚Ñ‹ Ğ¿Ğ¾ 744 ÑÑĞ¼Ğ¿Ğ»Ğ¾Ğ²
  for (int i = 0; i < pcmData.length; i += 744) {
    final chunk = pcmData.sublist(i, math.min(i + 744, pcmData.length));
    final ulawChunk = _encodeUlaw(chunk);
    
    // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ°ĞºĞµÑ‚
    final packet = _createCommandPacket(0x8e, ulawChunk);
    packets.add(packet);
  }
  
  return packets;
}
```

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 2: ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ°ÑƒĞ´Ğ¸Ğ¾

```dart
Future<void> displayImageDuringAudio() async {
  // 1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ (Ğ³Ğ»Ğ°Ğ·Ğ°)
  final img = CozmoSimpleImage.createEyes();
  img.drawRect(35, 8, 55, 16);    // Ğ›ĞµĞ²Ñ‹Ğ¹ Ğ³Ğ»Ğ°Ğ·
  img.drawRect(73, 8, 93, 16);    // ĞŸÑ€Ğ°Ğ²Ñ‹Ğ¹ Ğ³Ğ»Ğ°Ğ·
  
  // 2. ĞšĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² RLE
  final rleData = img.encodeRLE();
  
  // 3. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· AnimationController
  _animController.setCurrentImage(rleData);
  
  // 4. Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ¸ Ğ°ÑƒĞ´Ğ¸Ğ¾
  await playBasicAudio('/path/to/audio.wav');
}
```

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 3: ĞšĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½Ğ°Ñ ÑÑ†ĞµĞ½Ğ°

```dart
Future<void> performComplexScene() async {
  // 1. ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑƒĞ´Ğ¸Ğ²Ğ»Ñ‘Ğ½Ğ½Ğ¾Ğµ Ğ»Ğ¸Ñ†Ğ¾
  await playEmotion(CozmoEmotion.surprised);
  await Future.delayed(Duration(milliseconds: 500));
  
  // 2. Ğ’Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ¸ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹
  final audioTask = playAudioStreaming('/path/to/speech.wav');
  
  // 3. ĞĞ½Ğ¸Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ³Ğ»Ğ°Ğ·Ğ° Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ñ€ĞµÑ‡Ğ¸
  for (int i = 0; i < 10; i++) {
    final img = CozmoSimpleImage.createEyes();
    
    // ĞœĞ¸Ğ³Ğ°Ğ½Ğ¸Ğµ
    if (i % 3 == 0) {
      img.drawLine(35, 8, 55, 8);   // Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ»ĞµĞ²Ñ‹Ğ¹ Ğ³Ğ»Ğ°Ğ·
      img.drawLine(73, 8, 93, 8);   // Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ñ‹Ğ¹ Ğ³Ğ»Ğ°Ğ·
    }
    
    _animController.setCurrentImage(img.encodeRLE());
    await Future.delayed(Duration(milliseconds: 200));
  }
  
  // 4. Ğ”Ğ¾Ğ¶Ğ´Ğ°Ñ‚ÑŒÑÑ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ Ğ°ÑƒĞ´Ğ¸Ğ¾
  await audioTask;
  
  // 5. ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑÑ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ²ÑƒÑ ÑĞ¼Ğ¾Ñ†Ğ¸Ñ
  await playEmotion(CozmoEmotion.happy);
}
```

---

## Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Ğ¸ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ°

### Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ¸

#### 1. Ğ›Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²

```dart
class PacketLogger {
  static void logOutboundPacket(List<int> data) {
    final frameType = data[7];
    
    print('ğŸ“¤ [OUTBOUND] Frame: 0x${frameType.toRadixString(16)}');
    
    if (frameType == 0x07) { // ENGINE
      _logEnginePacket(data);
    } else if (frameType == 0x0b) { // PING
      _logPingPacket(data);
    }
  }
  
  static void _logEnginePacket(List<int> data) {
    if (data.length < 14) return;
    
    final packetType = data[14];
    if (packetType == 0x04) { // COMMAND
      final commandId = data[16];
      print('  ğŸ¯ Command: 0x${commandId.toRadixString(16)} (${_getCommandName(commandId)})');
      
      if (commandId == 0x8e) {
        print('  ğŸ”Š Audio packet (${data.length - 17} bytes)');
      } else if (commandId == 0x8f) {
        print('  ğŸ”‡ Silence packet');
      } else if (commandId == 0x26) {
        print('  ğŸ¬ Animation trigger');
      }
    }
  }
}
```

#### 2. ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ

```dart
class ConnectionMonitor {
  int _lastSeq = -1;
  int _lastAck = -1;
  final Map<int, DateTime> _packetTimestamps = {};
  
  void updateSequence(int seq, int ack) {
    if (seq != _lastSeq) {
      print('ğŸ“ˆ Seq: $_lastSeq â†’ $seq');
      _lastSeq = seq;
    }
    
    if (ack != _lastAck) {
      final latency = _calculateLatency(ack);
      print('ğŸ“‰ Ack: $_lastAck â†’ $ack (latency: ${latency}ms)');
      _lastAck = ack;
    }
  }
  
  void checkPacketLoss() {
    final now = DateTime.now();
    for (final entry in _packetTimestamps.entries) {
      if (now.difference(entry.value).inMilliseconds > 100) {
        print('âš ï¸ Packet ${entry.key} Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ½');
      }
    }
  }
}
```

#### 3. Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Audio Takeover

```dart
class AudioTakeoverMonitor {
  bool _lastAudioState = false;
  int _silencePacketsSent = 0;
  int _audioPacketsSent = 0;
  
  void onAudioStateChange(bool isBusy) {
    if (isBusy != _lastAudioState) {
      if (isBusy) {
        print('ğŸµ ğŸ”„ AUDIO TAKEOVER STARTED');
        print('  ğŸ“Š Silence packets sent: $_silencePacketsSent');
      } else {
        print('ğŸ”‡ ğŸ”„ AUDIO TAKEOVER ENDED');
        print('  ğŸ“Š Audio packets sent: $_audioPacketsSent');
      }
      _lastAudioState = isBusy;
    }
  }
  
  void onPacketSent(int commandId) {
    if (commandId == 0x8e) {
      _audioPacketsSent++;
    } else if (commandId == 0x8f) {
      _silencePacketsSent++;
    }
  }
}
```

### Ğ Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹

#### 1. ĞšĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ¸ silence

**Ğ¡Ğ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹:**
- ĞŸÑ€ĞµÑ€Ñ‹Ğ²Ğ¸ÑÑ‚Ñ‹Ğ¹ Ğ·Ğ²ÑƒĞº
- Ğ©ĞµĞ»Ñ‡ĞºĞ¸ Ğ¸Ğ»Ğ¸ Ñ‚Ğ¸ÑˆĞ¸Ğ½Ğ°
- ĞĞ±Ñ€Ñ‹Ğ² ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ

**Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°:**
```dart
// ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ Audio Takeover Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
if (_animController._isAudioBusy && _lastCommand == 0x8f) {
  print('âŒ ERROR: Silence packet sent during audio!');
}
```

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
- Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ğ¾ `setAudioBusy(true)` Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹ Ğ°ÑƒĞ´Ğ¸Ğ¾
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ `setAudioBusy(false)` Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ

#### 2. ĞŸĞµÑ€ĞµĞ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸

**Ğ¡Ğ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹:**
- Ğ—Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ·Ğ²ÑƒĞºĞ°
- ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· 5 ÑĞµĞºÑƒĞ½Ğ´

**Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°:**
```dart
if (_client.outboundQueueLength > 200) {
  print('âš ï¸ Queue overflow: ${_client.outboundQueueLength} packets');
}
```

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
- Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¾ĞºĞ½Ğ° (`_WINDOW_SIZE`)
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²
- Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ¸Ñ‚ÑŒ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸

#### 3. Ğ‘ÑƒÑ„ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹

**Ğ¡Ğ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹:**
- Ğ­ĞºÑ€Ğ°Ğ½ Ğ³Ğ°ÑĞ½ĞµÑ‚ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ°ÑƒĞ´Ğ¸Ğ¾
- Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ

**Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°:**
```dart
if (_animController._tickCounter % 30 != 0 && _currentImagePayload != null) {
  print('âš ï¸ Image not being updated regularly');
}
```

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
- Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ğ¾ DisplayImage Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Ñ€Ğ°Ğ· Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ `_currentImagePayload` ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½

---

## ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

### 1. ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ°

#### ĞŸÑ€ĞµĞ´Ğ²Ğ°Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ°ÑƒĞ´Ğ¸Ğ¾

```dart
class AudioOptimizer {
  // ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ² Ğ¿Ğ°ĞºĞµÑ‚Ñ‹ Ğ·Ğ°Ñ€Ğ°Ğ½ĞµĞµ
  static Future<List<List<int>>> preprocessAudio(String wavPath) async {
    final bytes = await File(wavPath).readAsBytes();
    final packets = <List<int>>[];
    
    // Ğ Ğ°ÑĞ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ
    final chunks = _splitAudio(bytes);
    final futures = chunks.map((chunk) => _convertChunkAsync(chunk));
    final results = await Future.wait(futures);
    
    for (final result in results) {
      packets.addAll(result);
    }
    
    return packets;
  }
  
  static Future<List<List<int>>> _convertChunkAsync(List<int> chunk) async {
    return await compute(_convertChunk, chunk); // Ğ’ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¼ isolate
  }
}
```

#### ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾

```dart
class AdaptiveWindow {
  int _currentWindowSize = 16;
  int _packetLossCount = 0;
  int _totalPackets = 0;
  
  void updatePacketLoss(int lost, int total) {
    _packetLossCount += lost;
    _totalPackets += total;
    
    final lossRate = _packetLossCount / _totalPackets;
    
    if (lossRate > 0.05) {
      // ĞŸĞ¾Ñ‚ĞµÑ€Ñ > 5% - ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ Ğ¾ĞºĞ½Ğ¾
      _currentWindowSize = math.min(_currentWindowSize + 4, 48);
      print('ğŸ“ˆ Increased window to $_currentWindowSize (loss: ${(lossRate * 100).toStringAsFixed(1)}%)');
    } else if (lossRate < 0.01 && _currentWindowSize > 16) {
      // ĞŸĞ¾Ñ‚ĞµÑ€Ñ < 1% - ÑƒĞ¼ĞµĞ½ÑŒÑˆĞ¸Ñ‚ÑŒ Ğ¾ĞºĞ½Ğ¾
      _currentWindowSize = math.max(_currentWindowSize - 2, 16);
      print('ğŸ“‰ Decreased window to $_currentWindowSize (loss: ${(lossRate * 100).toStringAsFixed(1)}%)');
    }
  }
}
```

### 2. ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹

#### ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ RLE Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```dart
class ImageCache {
  static final Map<String, List<int>> _cache = {};
  
  static List<int> getCachedImage(String key) {
    return _cache[key] ?? _createAndCache(key);
  }
  
  static List<int> _createAndCache(String key) {
    final img = _createImageByKey(key);
    final rleData = img.encodeRLE();
    _cache[key] = rleData;
    return rleData;
  }
  
  // ĞŸÑ€ĞµĞ´Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ñ… Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹
  static Future<void> preloadCommonImages() async {
    final commonImages = ['happy', 'sad', 'surprised', 'thinking'];
    
    for (final name in commonImages) {
      getCachedImage(name);
    }
  }
}
```

#### ĞŸĞ»Ğ°Ğ²Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ñ‹ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑĞ¼Ğ¸

```dart
class SmoothImageTransitions {
  static List<int> _interpolateImages(List<int> img1, List<int> img2, double t) {
    // ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ¿Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ´Ğ²ÑƒĞ¼Ñ RLE Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑĞ¼Ğ¸
    final result = <int>[];
    
    // Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ° RLE
    // Ğ­Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ğ¸
    
    return result;
  }
  
  static Future<void> animateTransition(
    CozmoAnimController controller,
    String fromKey,
    String toKey, {
    Duration duration = const Duration(milliseconds: 500),
  }) async {
    final fromImg = ImageCache.getCachedImage(fromKey);
    final toImg = ImageCache.getCachedImage(toKey);
    
    final steps = (duration.inMilliseconds / 50).round();
    
    for (int i = 0; i <= steps; i++) {
      final t = i / steps;
      final interpolated = _interpolateImages(fromImg, toImg, t);
      controller.setCurrentImage(interpolated);
      await Future.delayed(Duration(milliseconds: 50));
    }
  }
}
```

### 3. ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

#### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

```dart
class PerformanceMetrics {
  int _audioPacketsPerSecond = 0;
  int _imageUpdatesPerSecond = 0;
  int _retransmissionsPerSecond = 0;
  double _averageLatency = 0.0;
  
  void updateMetrics() {
    final now = DateTime.now();
    
    // Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ÑÑ ÑĞµĞºÑƒĞ½Ğ´Ñƒ
    final audioCount = _countRecentAudioPackets(now);
    final imageCount = _countRecentImageUpdates(now);
    final retransCount = _countRecentRetransmissions(now);
    
    _audioPacketsPerSecond = audioCount;
    _imageUpdatesPerSecond = imageCount;
    _retransmissionsPerSecond = retransCount;
    
    print('ğŸ“Š Performance Metrics:');
    print('  ğŸµ Audio: $_audioPacketsPerSecond packets/sec');
    print('  ğŸ–¼ï¸ Images: $_imageUpdatesPerSecond updates/sec');
    print('  ğŸ”„ Retrans: $_retransmissionsPerSecond packets/sec');
    print('  â±ï¸ Latency: ${_averageLatency.toStringAsFixed(1)}ms');
  }
}
```

---

## Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ñ‹

1. **Audio Takeover Pattern** - Ğ¾ÑĞ½Ğ¾Ğ²Ğ° ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ¸ Ğ²Ğ¸Ğ´ĞµĞ¾
2. **Reliable UDP** - ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ğ°Ğ¶ĞµĞ½ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ
3. **Sequence Numbers** - Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ÑÑ‚ Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²
4. **Sliding Window** - ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ğ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
5. **Frame-based Protocol** - ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ²ÑĞµÑ… ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¹

### Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

1. **Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ** Ğ¸Ğ· pycozmo ĞºĞ°Ğº Ğ¾ÑĞ½Ğ¾Ğ²Ñƒ
2. **Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Audio Takeover** Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¼ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼
3. **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€ÑŒÑ‚Ğµ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
4. **ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ´ ÑĞ²Ğ¾Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸** - Ğ°ÑƒĞ´Ğ¸Ğ¾, Ğ²Ğ¸Ğ´ĞµĞ¾ Ğ¸Ğ»Ğ¸ ÑĞ¼ĞµÑˆĞ°Ğ½Ğ½Ñ‹Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸
5. **ĞšÑÑˆĞ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹** - Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ RLE Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹

### Ğ”Ğ°Ğ»ÑŒĞ½ĞµĞ¹ÑˆĞµĞµ Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ğµ

1. **ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ñ‹** - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¾ĞºĞ½Ğ° Ğ¸ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚Ğ¾Ğ²
2. **ĞŸÑ€ĞµĞ´ÑĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑŒ** - Ğ¿Ñ€Ğ¾Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ñ€ĞµÑ‚Ñ€Ğ°Ğ½ÑĞ»ÑÑ†Ğ¸Ñ
3. **Ğ¡Ğ¶Ğ°Ñ‚Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹** - Ğ±Ğ¾Ğ»ĞµĞµ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ñ‹
4. **ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¾Ğ²Ğ¾Ğµ Ğ²Ğ¸Ğ´ĞµĞ¾** - Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ĞµĞµ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾Ğ¹ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
5. **ML-Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** - Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ°Ñ… Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

Ğ­Ñ‚Ğ° Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½ÑƒÑ Ğ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½ÑƒÑ Ğ¾ÑĞ½Ğ¾Ğ²Ñƒ Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ñ Cozmo, ÑĞ¾Ñ‡ĞµÑ‚Ğ°ÑÑ‰Ğ¸Ñ… Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ¸ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ„Ñ„ĞµĞºÑ‚Ñ‹.